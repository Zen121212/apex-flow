<div
  class="modal-overlay"
  [class.visible]="isVisible"
  (click)="onOverlayClick($event)"
>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Configure Approval Workflow</h2>
      <button class="close-btn" (click)="onClose()">&times;</button>
    </div>

    <div class="modal-body">
      <div class="workflow-description">
        <p>
          Set up approval workflows with conditional actions based on
          approval status.
        </p>
      </div>

      <!-- Approval Step Configuration -->
      <div class="config-section">
        <h4>Approval Method</h4>
        <p class="section-description">
          How should approvals be requested?
        </p>

        <div class="approval-options">
          <div
            class="option-card"
            *ngFor="let option of approvalOptions()"
            [class.selected]="selectedApproval()?.id === option.id"
            (click)="selectApproval(option)"
          >
            <div class="option-icon">{{ option.icon }}</div>
            <div class="option-info">
              <h5>{{ option.name }}</h5>
              <p>{{ option.description }}</p>
            </div>
          </div>
        </div>

        <!-- Approval Configuration -->
        <div class="approval-config" *ngIf="selectedApproval()">
          <div
            class="form-group"
            *ngIf="selectedApproval()?.type === 'slack_approval'"
          >
            <label for="slackApprovalChannel">Slack Channel</label>
            <select
              id="slackApprovalChannel"
              [(ngModel)]="approvalConfig.channel"
            >
              <option value="#approvals">#approvals</option>
              <option value="#management">#management</option>
              <option value="#finance">#finance</option>
              <option value="#general">#general</option>
            </select>
          </div>

          <div
            class="form-group"
            *ngIf="selectedApproval()?.type === 'email_approval'"
          >
            <label for="approvalEmails">Approver Emails</label>
            <input
              type="text"
              id="approvalEmails"
              [(ngModel)]="approvalConfig.recipients"
              placeholder="manager@company.com, finance@company.com"
            />
          </div>

          <div class="form-group">
            <label for="approvalTimeout">Approval Timeout (minutes)</label>
            <input
              type="number"
              id="approvalTimeout"
              [(ngModel)]="approvalConfig.timeout"
              placeholder="60"
              min="1"
              max="10080"
            />
          </div>
        </div>
      </div>

      <!-- Conditional Actions -->
      <div class="config-section">
        <h4>Conditional Actions</h4>
        <p class="section-description">
          What should happen based on the approval decision?
        </p>

        <!-- On Approval -->
        <div class="condition-section">
          <div class="condition-header">
            <span class="condition-icon">✅</span>
            <h5>When Approved</h5>
          </div>

          <div class="conditional-actions">
            <div
              class="action-card"
              *ngFor="let action of approvedActions()"
              [class.enabled]="action.enabled"
            >
              <div class="action-header">
                <div class="action-info">
                  <span class="action-icon">{{ action.icon }}</span>
                  <div>
                    <h6>{{ action.name }}</h6>
                    <p>{{ action.description }}</p>
                  </div>
                </div>
                <label class="action-toggle">
                  <input type="checkbox" [(ngModel)]="action.enabled" />
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="action-config" *ngIf="action.enabled">
                <!-- Database Action Config -->
                <div *ngIf="action.type === 'database'">
                  <div class="form-group">
                    <label>Database Table</label>
                    <input
                      type="text"
                      [(ngModel)]="action.config.tableName"
                      placeholder="invoices"
                    />
                  </div>
                  <div class="form-group">
                    <label>Fields to Save</label>
                    <input
                      type="text"
                      [(ngModel)]="action.config.fields"
                      placeholder="vendor, amount, date"
                    />
                  </div>
                </div>

                <!-- Webhook Action Config -->
                <div *ngIf="action.type === 'webhook'">
                  <div class="form-group">
                    <label>Webhook URL</label>
                    <input
                      type="url"
                      [(ngModel)]="action.config.url"
                      placeholder="https://api.company.com/webhook"
                    />
                  </div>
                  <div class="form-group">
                    <label>HTTP Method</label>
                    <select [(ngModel)]="action.config.method">
                      <option value="POST">POST</option>
                      <option value="PUT">PUT</option>
                      <option value="PATCH">PATCH</option>
                    </select>
                  </div>
                </div>

                <!-- Email Action Config -->
                <div *ngIf="action.type === 'email'">
                  <div class="form-group">
                    <label>Recipients</label>
                    <input
                      type="text"
                      [(ngModel)]="action.config.recipients"
                      placeholder="team@company.com"
                    />
                  </div>
                  <div class="form-group">
                    <label>Subject</label>
                    <input
                      type="text"
                      [(ngModel)]="action.config.subject"
                      placeholder="Document Approved: {document_name}"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- On Rejection -->
        <div class="condition-section">
          <div class="condition-header">
            <span class="condition-icon">❌</span>
            <h5>When Rejected</h5>
          </div>

          <div class="conditional-actions">
            <div
              class="action-card"
              *ngFor="let action of rejectedActions()"
              [class.enabled]="action.enabled"
            >
              <div class="action-header">
                <div class="action-info">
                  <span class="action-icon">{{ action.icon }}</span>
                  <div>
                    <h6>{{ action.name }}</h6>
                    <p>{{ action.description }}</p>
                  </div>
                </div>
                <label class="action-toggle">
                  <input type="checkbox" [(ngModel)]="action.enabled" />
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="action-config" *ngIf="action.enabled">
                <div *ngIf="action.type === 'email'">
                  <div class="form-group">
                    <label>Recipients</label>
                    <input
                      type="text"
                      [(ngModel)]="action.config.recipients"
                      placeholder="admin@company.com"
                    />
                  </div>
                  <div class="form-group">
                    <label>Subject</label>
                    <input
                      type="text"
                      [(ngModel)]="action.config.subject"
                      placeholder="Document Rejected: {document_name}"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- On Timeout -->
        <div class="condition-section">
          <div class="condition-header">
            <span class="condition-icon">⏰</span>
            <h5>When Timeout</h5>
          </div>

          <div class="conditional-actions">
            <div
              class="action-card"
              *ngFor="let action of timeoutActions()"
              [class.enabled]="action.enabled"
            >
              <div class="action-header">
                <div class="action-info">
                  <span class="action-icon">{{ action.icon }}</span>
                  <div>
                    <h6>{{ action.name }}</h6>
                    <p>{{ action.description }}</p>
                  </div>
                </div>
                <label class="action-toggle">
                  <input type="checkbox" [(ngModel)]="action.enabled" />
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="action-config" *ngIf="action.enabled">
                <div *ngIf="action.type === 'email'">
                  <div class="form-group">
                    <label>Recipients</label>
                    <input
                      type="text"
                      [(ngModel)]="action.config.recipients"
                      placeholder="escalation@company.com"
                    />
                  </div>
                  <div class="form-group">
                    <label>Subject</label>
                    <input
                      type="text"
                      [(ngModel)]="action.config.subject"
                      placeholder="Approval Timeout: {document_name}"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="modal-actions">
        <button class="btn btn-secondary" (click)="onClose()">
          Cancel
        </button>
        <button class="btn btn-primary" (click)="saveApprovalWorkflow()">
          Save Approval Workflow
        </button>
      </div>
    </div>
  </div>
</div>
